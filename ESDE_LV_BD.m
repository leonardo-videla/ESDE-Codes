function [n, t, sol]=ESDE_LV_BD (N)  %An example of ESDE modelling a time-varying food chain of uncountable species.   %Run through N epoch. Always use N > 4.  %Community matrix.   A=zeros(N+2, N+2);    A=A+diag(-0.3*ones(1, N+1), 1)+diag(0.3*ones(1, N+1), -1);    A(1:4, 1:4)=[-0.002 -0.080 0 0; 0.023 0 -0.25 0; 0 0.23 0 -0.3 ; 0 0 0.3 0];  c=-0.1*ones(N+2, 1); % Never will be more than N+2 species.   c(1, 1)=0.18;   c(2, 1)=-0.8;   x0=zeros(N+2, 1);  x0(1, 1)=40;  x0(2, 1)=0.5;  x0(3, 1)=0.5;    sigma=0.03*ones(N+2, 1);  h=0.01;      n=3*ones(N, 1);  len=zeros(N,1);            %The chain starts with two species.  len(1,1)= (1/(mu(3)+nu(3)))*rande(1);    for j=2:N    p=rand;    ind=n(j-1, 1);    q=nu(ind)/(mu(ind)+nu(ind));    if (p<q)      n(j,1)=ind-1;    else       n(j,1)=ind+1;    endif    ind=n(j,1);    len(j)=(1/ (mu(ind)+nu(ind)))*rande(1);  endfor    n  TT=sum(len);  t=[0:h:floor(TT/h)];  sol=zeros(4, length(t));  aux=0;  C=colormap(jet(max(n)-min(n)+3));  colormap(C)  close all;  figure(1); hold on;  figure(2); hold on;  figure(3); hold on;  for j=1:N    [t1, s]=Multi_LV (x0(1:n(j)), c(1:n(j)), A(1:n(j), 1:n(j)), sigma(1:n(j)), len(j), h);    nn=length(t1);    sol(1:n(j), aux+1:aux+nn)=s;        %The last state of the chain.     last=s(n(j),nn);        if (j < N)           %Here we encode the transfer kernel.      if (n(j)>n(j+1)) % A species has dissapeared: RIP and party        x0(1:n(j+1)-1, 1)=s(1:n(j+1)-1, nn);        x0(n(j+1), 1)=s(n(j+1), nn)+s(n(j), nn)*0.8;       else %A newcomer has arrived!        x0(1:n(j), 1)=s(1:n(j), nn);        x0(n(j+1), 1)= 0.05*s(n(j), nn);        x0(n(j), 1)=0.95*s(n(j), nn);       endif          endif        %Plotting the solution for the first, second and third species.          abscisa=([0:1:nn-1]+(aux)*ones(1, nn))*h;            figure(1);    plot(abscisa, s(1, :), "color", C(n(j), :));    figure(2);    plot(abscisa, s(2, :), "color", C(n(j), :));    figure(3);    plot(abscisa, s(3, :), "color", C(n(j), :));    aux=aux+nn;  endfor      figure(1);  xlabel("Time");  ylabel("Abundance");  title("Evolution of the autotrophic species");  colormap(C);  h=colorbar();  ylabel(h, "Number of species");  caxis([0 max(n)]);  hold off;  figure(2);  xlabel("Time");  ylabel("Abundance");  title("Evolution of the first level consumer");  colormap(C);  h=colorbar();  ylabel(h, "Number of species");  caxis([0 max(n)]);  hold off;    figure(3);  xlabel("Time");  ylabel("Abundance");  title("Evolution of the second level consumer");  colormap(C);  h=colorbar();  ylabel(h, "Number of species");  caxis([0 max(n)]);  hold off;    endfunction