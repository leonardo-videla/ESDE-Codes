function [n, t, sol]=ESDE_LV_COMPETITIVE (N)  %An example of ESDE modelling a time-varying competitive ecosystem (after Shtilerman et al., 2015)   %Community matrix.     param=ones(N+1);  for k=1:N+1     param(k)=-0.5*k/(N+1);  endfor  A=zeros(N+1, N+1);  for k=1:N+1    for l=1:N+1      A(k,l)=param(k)/(1+abs(k-l));    endfor  endfor  A=(A+A')/2;  c=0.1*ones(N+1, 1); % Never will be more than N species.     x0=zeros(N+1, 1);  x0(1, 1)=0.5;  x0(2, 1)=0.5;  x0(3, 1)=0.5;  xarrival=x0;  sigma=0.03*ones(N+1, 1);  h=0.01;      n=3*ones(N+1, 1);  len=zeros(N+1,1);            %The chain starts with two species.  len(1,1)=exprnd (1/(mu(3)+nu(3)));    for j=2:N    p=rand;    ind=n(j-1, 1);    q=nu(ind)/(mu(ind)+nu(ind));    if (p<q)      n(j,1)=ind-1;    else       n(j,1)=ind+1;    endif    ind=n(j,1);    len(j)=exprnd(1/ (mu(ind)+nu(ind)));  endfor  TT=sum(len);  t=[0:h:floor(TT/h)];  sol=zeros(4, length(t));  aux=0;  C=colormap(jet(max(n)-min(n)+3));  colormap(C)  close all;  figure(1); hold on;  figure(2); hold on;  figure(3); hold on;  for j=1:N    [t1, s]=Multi_LV (x0(1:n(j)), c(1:n(j)), A(1:n(j), 1:n(j)), sigma(1:n(j)), len(j), h);    nn=length(t1);    sol(1:n(j), aux+1:aux+nn)=s;        %The last state of the chain.     last=s(n(j),nn);        if (j < N)           %Here we encode the transfer kernel.      if (n(j)>n(j+1)) % A species has dissapeared: RIP and party        x0(1:n(j+1)-1, 1)=s(1:n(j+1)-1, nn);        x0(n(j+1), 1)=s(n(j+1), nn)+s(n(j), nn)*0.01;       else %A newcomer has arrived!        x0(1:n(j), 1)=s(1:n(j), nn);        x0(n(j), 1)=s(n(j), nn)*0.95;        x0(n(j+1), 1)= 0.05*s(n(j), nn);      %  x0(n(j), 1)=s(n(j), nn);       endif          endif        %Plotting the solution for the first and second species.          abscisa=([0:1:nn-1]+(aux)*ones(1, nn))*h;            figure(1);    plot(abscisa, s(1, :), "color", C(n(j), :));    figure(2);    plot(abscisa, s(2, :), "color", C(n(j), :));    figure(3);    plot(abscisa, s(3, :), "color", C(n(j), :));    aux=aux+nn;  endfor      figure(1);  xlabel("Time");  ylabel("Abundance");  title("Evolution of the autotrophic species");  colormap(C);  h=colorbar();  ylabel(h, "Number of species");  caxis([0 max(n)]);  hold off;  figure(2);  xlabel("Time");  ylabel("Abundance");  title("Evolution of the first level consumer");  colormap(C);  h=colorbar();  ylabel(h, "Number of species");  caxis([0 max(n)]);  hold off;    figure(3);  xlabel("Time");  ylabel("Abundance");  title("Evolution of the second level consumer");  colormap(C);  h=colorbar();  ylabel(h, "Number of species");  caxis([0 max(n)]);  hold off;    endfunction